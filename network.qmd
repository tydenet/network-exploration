---
title: "Network visualisation"
format:
  html:
    code-fold: true
    page-layout: custom
jupyter: python3
---

This document includes a couple of visualisations of the herbarium network - one using plotly (to display a map background), one with sigma.

## Flourish
```{html}
<iframe src='https://flo.uri.sh/visualisation/13576337/embed' title='Interactive or visual content' class='flourish-embed-iframe' frameborder='0' scrolling='no' style='width:100%;height:600px;' sandbox='allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation'></iframe><div style='width:100%!;margin-top:4px!important;text-align:right!important;'><a class='flourish-credit' href='https://public.flourish.studio/visualisation/13576337/?utm_source=embed&utm_campaign=visualisation/13576337' target='_top' style='text-decoration:none!important'><img alt='Made with Flourish' src='https://public.flourish.studio/resources/made_with_flourish.svg' style='width:105px!important;height:16px!important;border:none!important;margin:0!important;'> </a></div>
```

## plotly
```{python}
import plotly.graph_objects as go
import pandas as pd

df_nodes = pd.read_csv('data/ipnitypes_nodes.csv',sep='\t')

df_edges = pd.read_csv('data/ipnitypes_edges.csv',sep='\t')
df_edges = pd.merge(left=df_edges,right=df_nodes.set_index('node_id')[['latitude','longitude']],left_on='from',right_index=True,how='left')
df_edges.rename(columns={'latitude':'latitude_from','longitude':'longitude_from'},inplace=True)
df_edges = pd.merge(left=df_edges,right=df_nodes.set_index('node_id')[['latitude','longitude']],left_on='to',right_index=True,how='left')
df_edges.rename(columns={'latitude':'latitude_to','longitude':'longitude_to'},inplace=True)

fig = go.Figure()

fig.add_trace(go.Scattergeo(
    # locationmode = 'USA-states',
    lon = df_nodes['longitude'],
    lat = df_nodes['latitude'],
    hoverinfo = 'text',
    text = df_nodes['type_holder_code'],
    mode = 'markers',
    marker = dict(
        size = 4,
        color = 'rgb(255, 0, 0)',
        line = dict(
            width = 3,
            color = 'rgba(68, 68, 68, 0)'
        )
    )))

flight_paths = []
for i in range(len(df_edges)):
    fig.add_trace(
        go.Scattergeo(
            locationmode = 'USA-states',
            lon = [df_edges['longitude_from'][i], df_edges['longitude_to'][i]],
            lat = [df_edges['latitude_from'][i], df_edges['latitude_to'][i]],
            mode = 'lines',
            hoverinfo='none',
            line = dict(width = float(df_edges['weight'][i]) / float(df_edges['weight'].max())*10,color = 'red'),
            opacity = 0.5,
        )
    )

fig.update_layout(
    title_text = 'Herbarium duplicate network (hover for holder codes)',
    showlegend = False,
    width=1500,
    height=1200,
    geo = dict(
        # scope = 'worldwide',
        # projection_type = 'azimuthal equal area',
        showland = True,
        showcountries=True,
        # showborders = True,
        landcolor = 'rgb(243, 243, 243)',
        countrycolor = 'rgb(204, 204, 204)',
    ),
)

fig.show()
```

## Sigma
```{python}
import networkx as nx
from ipysigma import Sigma
g = nx.read_gexf('data/ipnitypes.gexf')
Sigma(g, node_size=g.degree)
```
